# README

## Описание приложения

Данное приложение представляет собой мини-сервис для конвертации видео формата MP4 в GIF, разработанный с использованием Angular и Express. Сервис реализует функциональность, соответствующую следующим требованиям:

- **Входной формат**: MP4, максимальный размер 1024x768, длина до 10 секунд.
- **Выходной формат**: GIF, размер 1x400, FPS = 5.
- **API**: Способен обрабатывать до 1000 запросов на конвертацию в минуту.
- **Время ожидания**: Не должно превышать 5 минут.
- **Docker Swarm**: Сервис упакован для работы в Docker Swarm.
- **Число реплик веб-сервера**: 1.
- **Число воркеров**: до 5.

## Структура приложения

Приложение разделено на три основные части: **client**, **server** и **test**.

### Client

Клиентская часть написана на Angular и имеет минималистичный дизайн, вдохновленный популярными конвертерами видео.

- **Файл** `src/app/services/conversion.service.ts`: В этом файле реализован сервис для конвертации видео. Он использует `axios` для отправки файла MP4 на сервер и обработки ответа с GIF.

#### Установка и запуск клиента

Для установки зависимостей и запуска клиентского приложения выполните команды:


- npm install
- npm run build
- npm run start

### Server

Серверная часть приложения реализована на **Express** и использует **Bull** для обработки очередей задач.

В серверной части используется **Redis** для управления очередями, что позволяет эффективно обрабатывать запросы на конвертацию. Когда запрос поступает на сервер, он добавляется в очередь с помощью библиотеки Bull. Это позволяет обрабатывать до 1000 запросов в минуту, соблюдая установленные ограничения.

Задачи обрабатываются асинхронно, и при успешном завершении пользователю отправляется готовый GIF файл. В случае ошибки задача помечается как неуспешная, и информация об этом записывается в логи.

- **Файл** `src/queue/queue.js`: Этот файл настраивает очередь для обработки задач на конвертацию. Он управляет конфигурацией подключения к Redis и задает лимиты для очереди.

В этом файле используется Redis для хранения задач, а также реализуется логика обработки задач в очереди. Каждая задача получает путь к файлу, который необходимо конвертировать. При успешной обработке результата выводится сообщение об успешной конвертации, а готовый GIF файл отправляется пользователю через HTTP-ответ. Если происходит ошибка в процессе конвертации, задача помечается как неуспешная, и выводится ошибка в логи.

Redis управляет состоянием очереди, позволяя обрабатывать до пяти фоновых воркеров одновременно, что обеспечивает быструю обработку запросов.

#### Установка и запуск сервера

Для установки зависимостей и запуска серверной части выполните:


- npm install
- npm run start:prod

### Docker

Приложение также настроено для работы в **Docker Swarm**.

- **Файл** `docker-compose.yml`: В этом файле описана конфигурация сервисов. Он включает API для обработки запросов, рабочие сервисы для выполнения фоновых задач по конвертации и Redis для управления очередями задач.

#### Описание конфигурации Docker

- **API**: Основной сервис для обработки запросов.
- **Worker**: Сервисы для выполнения фоновых задач по конвертации.
- **Redis**: Используется для управления очередями задач.

### Test

В папке **test** находится скрипт для нагрузочного тестирования:

- **Файл** `load_test.sh`: Этот скрипт позволяет отправлять заданное количество запросов на конвертацию. Вы можете настроить общее количество запросов и количество параллельных запросов для тестирования.

#### Запуск теста

Для запуска теста достаточно написать:


- ./load_test.sh

## Заключение

Все условия задания выполнены. Приложение предоставляет функциональность для конвертации видео с использованием современного подхода к обработке запросов через очереди и Docker. Оно эффективно обрабатывает запросы на конвертацию, обеспечивает стабильную работу при высокой нагрузке и позволяет масштабировать сервисы с помощью Docker Swarm. Благодаря использованию Redis для управления очередями и Bull для обработки задач, приложение может справляться с большим количеством запросов, что делает его подходящим для реальных условий эксплуатации.
